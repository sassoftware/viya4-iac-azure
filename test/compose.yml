services:
  test:
    build: .
    environment:
      TF_VAR_subscription_id: ${TF_VAR_subscription_id?pls set subscription id}
      TF_VAR_tenant_id: ${TF_VAR_tenant_id?pls set tenant id}
      TF_VAR_client_id: ${TF_VAR_client_id?pls set client id}
      TF_VAR_client_secret: ${TF_VAR_client_secret?pls set secret}
    volumes:
      - ./../:/root/viya4-iac-azure
    working_dir: /root/viya4-iac-azure/test
    command: >
      bash -c "git config --global --add safe.directory /root/viya4-iac-azure
      && go test default_integration_plan_test.go -timeout 30m"
